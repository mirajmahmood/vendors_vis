<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Vendors by Governate</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no'/>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>
	<script src="https://d3js.org/d3-scale-chromatic.v0.3.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.js'></script>
	<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.css' rel='stylesheet' />
	
	<script src='csv2geojson.js'></script>
	<script type="text/javascript" src="vendors.js"></script>
	<script type="text/javascript" src="customers.js"></script>
	<script type="text/javascript" src="drivers.js"></script>
	<script type="text/javascript" src="main.js"></script>
    

    <style>
        body { font-family:'Arial'; font-size:12px; margin:0; padding:0; }
        
        html, body {
		    max-width: 100%;
		    overflow-x: hidden;
		}
        #vendor_map { position:absolute; top:100px; bottom:0; width:80%; height: 80%  }
        #customer_map { padding-left:10px; }
        #customer_heat_map { position:absolute; top:100px; bottom:0; width:50%; height: 80%; padding:10px; }
        #customer_bar { position:absolute; top:100px; bottom:0; left:900px; width:80%; height: 80%; padding:10px; }

        #order_num { position:absolute; top:100px; bottom:0; width:50%; height: 80%; padding:10px; }
        #order_num_bar { position:absolute; top:100px; bottom:0; left:900px; width:80%; height: 80%; padding:10px; }

        #total_revenue { position:absolute; top:100px; left:20px; bottom:0; width:50%; height: 80%; padding:10px; }
        #total_revenue_bar { position:absolute; top:100px; bottom:0; left:900px; width:80%; height: 80%; padding:10px; }

        #basket_size { position:absolute; top:100px; bottom:0; width:50%; height: 80%; padding:10px; }
        #basket_size_bar { position:absolute; top:100px; bottom:0; left:900px; width:80%; height: 80%; padding:10px; }

        #order_num_title {padding-left: 10px;}
        #total_revenue_title {padding-left: 10px;}
        #basket_title {padding-left: 10px;}

        #customers_order_time { position:absolute; top:700px; bottom:0; width:65%; height: 90%; padding:10px; }
    </style>
</head>
<body>

<div id='controls' style="padding:10px">
	<button onclick="javascript:switch_display('vendor');"> Vendors site</button>
	<button onclick="javascript:switch_display('customer');"> Customer site</button>
	<button onclick="javascript:switch_display('driver');"> Driver site </button>
</div>

<div id="customer_map">

	<label>Month:</label>
	<select id='orders_month' onchange="javascript:get_customer_month(value);">
		
		<option id="March" value="March">March</option>
		<option id="April" value="April">April</option>
		<option id="May" value="May">May</option>
		<option id="June" value="June">June</option>
		<!-- <option id="July" value="July">July</option> -->
	</select>

	<label>Map Type:</label>
	<select id='customer_map_type' onchange="javascript:switch_customer_map_type(value);">
		
		<option id="order_num_option" value="order_num" >Number of Orders</option>
		<option id="basket_size_option" value="basket_size" >Basket Size</option>
		<option id="total_revenue_option" value="total_revenue" >Total Revenue</option>
		
	</select>

	<h3 id='customer_title'> Number of Orders</h3>
	<div id='customer_heat_map'></div>

	<div id='customer_bar'></div>
	

	<div id="customers_order_time"></div>
	<div id="customers_table"></div>
</div>

<div id='vendor_map'>
	<label>Vendor type:</label>
	<select id='vendor' onchange="javascript:get_cluster(value);">
		<option id="All" value="All">All</option>
		<option id="Restaurants" value="Restaurants">Restaurants</option>
		<option id="Pharmacy" value="Pharmacy">Pharmacy</option>
		<option id="Grocery" value="Grocery">Grocery</option>
		<option id="Cafe & Desserts" value="Cafe & Desserts">Cafe & Desserts</option>
		<option id="Health & Beauty" value="Health & Beauty">Health & Beauty</option>
	</select>
</div>

<div id='driver_map'></div>



<script type="text/javascript">
	var months_customer_data = {
		"March": {

			"orders": "https://query.data.world/s/e6tdhwkamycjnwev6mtjhvyug6om5n",
			"cost": "https://query.data.world/s/csf6y4ljcvzy65euzk6wuocbl53foo",
			"temporal": "https://query.data.world/s/iuqnvz7ca4jtcynqor3kwv2hnsn54n",
			"basket_size": "https://query.data.world/s/floqj3m2lrme7lvfv2k5ev7hxgbdkh",
		},
		"April": {

			"orders": "https://query.data.world/s/ppnhuidzy5rypmxhixcnex7ivgrp65",
			"cost": "https://query.data.world/s/jxb77wcy3ci26bdcsmnhian2pvyxc2",
			"temporal": "https://query.data.world/s/cckeacn2z4na4gvmvsa336kdezoblz",
			"basket_size": "https://query.data.world/s/ci6fvnrfhg7hoykmqmyvdftvkdfd6c",
		},
		"May": {

			"orders": "https://query.data.world/s/binumon76auywni6rpolempwjpr5bi",
			"cost": "https://query.data.world/s/6oi24nusuacmglwsyrewsquw4w7cw3",
			"temporal": "https://query.data.world/s/rawvyvjdiqptvvm3pmjnofqkldmbte",
			"basket_size": "https://query.data.world/s/tq2pafoga7z76diakz533hh5esv2sv",
		},
		"June": {

			"orders": "https://query.data.world/s/nvqqgkg5aiysmppxg4tsbcv2dx2llx",
			"cost": "https://query.data.world/s/woqgr6z37hymbk4pc7mrqayvsildlp",
			"temporal": "https://query.data.world/s/izxakvqvffetx37bw3xsxzsba5swdx",
			"basket_size": "https://query.data.world/s/7uyme4sz37ov37m46mam6yssscm26z",

		},
	};

	mapboxgl.accessToken = 'pk.eyJ1Ijoibm90bWlyYWoiLCJhIjoiY2pmYzd4Nno0MXRiNzQwcTdydXNibzZtaCJ9.KwcKrFYXAQp-LqhyX-8l1Q';
	var map_vendor = new mapboxgl.Map({
	    container: 'vendor_map', // container id
	    style: 'mapbox://styles/mapbox/streets-v9', // stylesheet location
	    center: [47.990965, 29.367537], // starting position [lng, lat]
	    zoom: 13 // starting zoom
	});

	function switch_display(switch_to){
		if (switch_to == "vendor"){
			var driver_map = document.getElementById("driver_map");
			var customer_map = document.getElementById("customer_map");
			var vendor_map = document.getElementById("vendor_map");

			driver_map.style.display = 'none';
			customer_map.style.display = 'none';
			vendor_map.style.display = '';

			$(".customer").each(function(d) {
                 $(this).css("display", "none");
            });
		}
		else if(switch_to == "customer"){
			var driver_map = document.getElementById("driver_map");
			var customer_map = document.getElementById("customer_map");
			var vendor_map = document.getElementById("vendor_map");

			driver_map.style.display = 'none';
			customer_map.style.display = '';
			vendor_map.style.display = 'none';

			$(".customer").each(function(d) {
                 $(this).css("display", "");
            });
		}
		else if(switch_to == "driver"){
			var driver_map = document.getElementById("driver_map");
			var customer_map = document.getElementById("customer_map");
			var vendor_map = document.getElementById("vendor_map");

			driver_map.style.display = '';
			customer_map.style.display = 'none';
			vendor_map.style.display = 'none';

			$(".customer").each(function(d) {
                 $(this).css("display", "none");
            });
		}
		

	}

	function switch_customer_map_type(switch_to){


		var customer_title = document.getElementById("customer_title");
		var month = document.getElementById("orders_month").value
		var url = ""

		if (switch_to == "order_num"){
			customer_title.innerText = "Number of Orders";
			url = months_customer_data[month]['orders']

		}
		else if(switch_to == "basket_size"){
			customer_title.innerText = "Basket Size";
			url = months_customer_data[month]['basket_size']

		}
		else if(switch_to == "total_revenue"){
			customer_title.innerText = "Total Revenue";
			url = months_customer_data[month]['cost']

		}
		var kwtData_url = "https://query.data.world/s/dk5r7fnrj4fmvstrw2abu66sp3vtym"
		d3.json(kwtData_url, function(errors, kwtData){
			d3.json(url, function(errors, jsonData){
					change_map_data(jsonData, "customer_heat_map");
					change_bar_data(jsonData, "customer_bar");
				})
		})

	}



	switch_display("customer");
	switch_customer_map_type("basket_size");
</script>
</body>
</html>